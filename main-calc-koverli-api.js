window.buttonsList = [
   {currencySymbol: '$', countryFlag: 'ðŸ‡ºðŸ‡¸', currencyName: 'USD', currencyDescription: 'United States dollar'},
   {currencySymbol: 'â‚¬', countryFlag: 'ðŸ‡ªðŸ‡º', currencyName: 'EUR', currencyDescription: 'Euro'},
   {currencySymbol: 'Ø¯.Ø¥', countryFlag: 'ðŸ‡¦ðŸ‡ª', currencyName: 'AED', currencyDescription: 'United Arab Emirates Dirham'},
   {currencySymbol: 'A$', countryFlag: 'ðŸ‡¦ðŸ‡º', currencyName: 'AUD', currencyDescription: 'Australian Dollar'},
   {currencySymbol: 'Ð›Ð².', countryFlag: 'ðŸ‡§ðŸ‡¬', currencyName: 'BGN', currencyDescription: 'Bulgarian Lev'},
   {currencySymbol: 'C$', countryFlag: 'ðŸ‡¨ðŸ‡¦', currencyName: 'CAD', currencyDescription: 'Canadian Dollar'},
   {currencySymbol: 'CHf', countryFlag: 'ðŸ‡¨ðŸ‡­', currencyName: 'CHF', currencyDescription: 'Swiss Franc'},
   {currencySymbol: 'Â¥', countryFlag: 'ðŸ‡¨ðŸ‡³', currencyName: 'CNY', currencyDescription: 'Chinese Yuan'},
   {currencySymbol: 'KÄ', countryFlag: 'ðŸ‡¨ðŸ‡¿', currencyName: 'CZK', currencyDescription: 'Czech Koruna'},
   {currencySymbol: 'Kr.', countryFlag: 'ðŸ‡©ðŸ‡°', currencyName: 'DKK', currencyDescription: 'Danish Krone'},
 	 {currencySymbol: 'Â£', countryFlag: 'ðŸ‡¬ðŸ‡§', currencyName: 'GBP', currencyDescription: 'British Pound'},
   {currencySymbol: 'HK$', countryFlag: 'ðŸ‡­ðŸ‡°', currencyName: 'HKD', currencyDescription: 'Hong Kong Dollar'},
   /*{currencySymbol: 'kn', countryFlag: 'ðŸ‡­ðŸ‡·', currencyName: 'HRK', currencyDescription: 'Croatian Kuna'},*/
   {currencySymbol: 'Ft', countryFlag: 'ðŸ‡­ðŸ‡º', currencyName: 'HUF', currencyDescription: 'Hungarian Forint'},
   {currencySymbol: 'Rp', countryFlag: 'ðŸ‡®ðŸ‡©', currencyName: 'IDR', currencyDescription: 'Indonesian Rupiah'},
   {currencySymbol: 'â‚ª', countryFlag: 'ðŸ‡®ðŸ‡±', currencyName: 'ILS', currencyDescription: 'Israeli New Sheqel'},
   /*{currencySymbol: 'â‚¹', countryFlag: 'ðŸ‡®ðŸ‡³', currencyName: 'INR', currencyDescription: 'Indian Rupee'},*/
   {currencySymbol: 'Â¥', countryFlag: 'ðŸ‡¯ðŸ‡µ', currencyName: 'JPY', currencyDescription: 'Japanese Yen'},
   {currencySymbol: '/-', countryFlag: 'ðŸ‡°ðŸ‡ª', currencyName: 'KES', currencyDescription: 'Kenyan Shilling'},
   {currencySymbol: 'Ùƒ', countryFlag: 'ðŸ‡°ðŸ‡¼', currencyName: 'KWD', currencyDescription: 'Kuwaiti Dinar'},
   {currencySymbol: 'Mex$', countryFlag: 'ðŸ‡²ðŸ‡½', currencyName: 'MXN', currencyDescription: 'Mexican Peso'},
   {currencySymbol: 'RM', countryFlag: 'ðŸ‡²ðŸ‡¾', currencyName: 'MYR', currencyDescription: 'Malaysian Ringgit'},
   {currencySymbol: 'kr', countryFlag: 'ðŸ‡³ðŸ‡´', currencyName: 'NOK', currencyDescription: 'Norwegian Krone'},
   {currencySymbol: '$', countryFlag: 'ðŸ‡³ðŸ‡¿', currencyName: 'NZD', currencyDescription: 'New Zealand Dollar'},
   {currencySymbol: 'Ø±.Ø¹', countryFlag: 'ðŸ‡´ðŸ‡²', currencyName: 'OMR', currencyDescription: 'Omani Rial'},
   {currencySymbol: 'â‚±', countryFlag: 'ðŸ‡µðŸ‡­', currencyName: 'PHP', currencyDescription: 'Philippine Peso'},
   {currencySymbol: 'zÅ‚', countryFlag: 'ðŸ‡µðŸ‡±', currencyName: 'PLN', currencyDescription: 'Polish Zloty'},
   {currencySymbol: 'Ø±.Ù‚', countryFlag: 'ðŸ‡¶ðŸ‡¦', currencyName: 'QAR', currencyDescription: 'Qatari Rial'},
   {currencySymbol: 'lei', countryFlag: 'ðŸ‡·ðŸ‡´', currencyName: 'RON', currencyDescription: 'Romanian New Leu'},
   {currencySymbol: 'Ø±.Ø³', countryFlag: 'ðŸ‡¸ðŸ‡¦', currencyName: 'SAR', currencyDescription: 'Saudi Riyal'},
   {currencySymbol: 'kr', countryFlag: 'ðŸ‡¸ðŸ‡ª', currencyName: 'SEK', currencyDescription: 'Swedish Krona'},
   {currencySymbol: 'S$', countryFlag: 'ðŸ‡¸ðŸ‡¬', currencyName: 'SGD', currencyDescription: 'Singapore Dollar'},
   {currencySymbol: 'à¸¿', countryFlag: 'ðŸ‡¹ðŸ‡­', currencyName: 'THB', currencyDescription: 'Thai Baht'},
   {currencySymbol: 'â‚º', countryFlag: 'ðŸ‡¹ðŸ‡·', currencyName: 'TRY', currencyDescription: 'Turkish Lira'},
   {currencySymbol: 'USh', countryFlag: 'ðŸ‡ºðŸ‡¬', currencyName: 'UGX', currencyDescription: 'Ugandan Shilling'},
   {currencySymbol: 'R', countryFlag: 'ðŸ‡¿ðŸ‡¦', currencyName: 'ZAR', currencyDescription: 'South African Rand'}
];

window.sellList = [
    {
        currencySymbol: "$",
        countryFlag: "ðŸ‡ºðŸ‡¸",
        currencyName: "USD",
        currencyDescription: "United States dollar",
    },
];

window.sellList = [
    {
        currencySymbol: "$",
        countryFlag: "ðŸ‡ºðŸ‡¸",
        currencyName: "USD",
        currencyDescription: "United States dollar",
    },
];

window.addEventListener("alpine:init", () => {
    // sort a-z
    buttonsList.sort(function (a, b) {
        var textA = a.currencyName.toUpperCase();
        var textB = b.currencyName.toUpperCase();
        return textA < textB ? -1 : textA > textB ? 1 : 0;
    });
    Alpine.data("exchanger", () => ({
        data: {
            buyCurrency: {
                currencySymbol: "â‚¬",
                countryFlag: "ðŸ‡ªðŸ‡º",
                currencyName: "EUR",
                currencyDescription: "Euro",                
            },
            sellCurrency: {
                currencySymbol: "$",
                countryFlag: "ðŸ‡ºðŸ‡¸",
                currencyName: "USD",
                currencyDescription: "United States dollar",
            },
            valueFrom: '1,000',
            valueTo: '0',
            rate: 1,
            inverseRate: 1,
            valueFromNumber: '',
            valueToNumber: '',
            rateLock: 0,
            totalFrom: 0,
            
        },
        init() {
            this.refreshData(this.sellValue);
        },

        validate(evt) {
            var theEvent = evt || window.event;

            // Handle paste
            if (theEvent.type === "paste") {
                key = event.clipboardData.getData("text/plain");
            } else {
                // Handle key press
                var key = theEvent.keyCode || theEvent.which;
                key = String.fromCharCode(key);
            }
            var regex = /[0-9]|\./;
            if (!regex.test(key)) {
                theEvent.returnValue = false;
                if (theEvent.preventDefault) theEvent.preventDefault();
            }
        },

        async refreshData(callback) {
            let result;
            let inverseResult;
            try {
                let buy = this.data.buyCurrency.currencyName;
                let sell = this.data.sellCurrency.currencyName;
                const response = await fetch(
                    "https://app.koverly.com/api/currency/rate",
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            buyCurrency: sell,
                            sellCurrency: buy,
                        }),
                        redirect: "follow",
                    }
                );
                const inverseResponse = await fetch(
                    "https://app.koverly.com/api/currency/rate",
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            buyCurrency: buy,
                            sellCurrency: sell,
                        }),
                        redirect: "follow",
                    }
                );
                result = JSON.parse(await response.text());
                inverseResult = JSON.parse(await inverseResponse.text());
            } catch (e) {
                console.log(e);
            }
            this.data.rate = result.rate;
            this.data.inverseRate = inverseResult.rate;
            if (callback) {
                callback.apply(this);
            }
        },

        sellValue() {
            this.refreshData();
            this.data.valueFromNumber = Number(parseFloat(this.data.valueFrom.replace(/,/g, '')));
            this.data.rateLock = this.data.valueFromNumber * 0.001;
            this.data.totalFrom = this.data.valueFromNumber - this.data.rateLock;
            this.data.valueToNumber = this.data.totalFrom * this.data.rate;
            this.data.valueTo = this.data.valueToNumber.toLocaleString("en-US", {maximumFractionDigits: 2,});
            this.data.rateLock = this.data.rateLock.toLocaleString("en-US", {maximumFractionDigits: 2,});
            this.data.totalFrom = this.data.totalFrom.toLocaleString("en-US", {maximumFractionDigits: 2,});
            console.log("sell");
        },

        buyValue() {
            this.refreshData();
            this.data.valueToNumber = Number(parseFloat(this.data.valueTo.replace(/,/g, '')));
            this.data.valueFromNumber = this.data.valueToNumber / this.data.rate / 0.999;
            this.data.rateLock = this.data.valueFromNumber * 0.001;
            this.data.totalFrom = this.data.valueFromNumber - this.data.rateLock;
            this.data.valueFrom = this.data.valueFromNumber.toLocaleString("en-US", {maximumFractionDigits: 2,});
            this.data.rateLock = this.data.rateLock.toLocaleString("en-US", {maximumFractionDigits: 2,});
            this.data.totalFrom = this.data.totalFrom.toLocaleString("en-US", {maximumFractionDigits: 2,});
            console.log("buy" , "valueFromNumber = " + this.data.valueFromNumber, "valueFrom = " + this.data.valueFrom);
        },
    }));
});
